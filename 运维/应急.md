# 客户应急

> 一些生产问题的应急处理，遵循的原则是：**不要慌，不要急，不要乱**。优先级：**安全第一，稳定第二，性能第三**。

## 一些意识

- 修改配置文件、源程序、数据库前都要有备份意识
- 问题的解决要有闭环意识
- 问题的记录要有规范意识
- 问题的处理要有流程意识

## 问题分类

1. 问题类型：问题、需求、BUG、优化
2. 问题级别：P0、P1、P2、P3

## “后门”

1. 预留灵活的开发人员参数（业务方用不上）
2. 提供线程池监控、缓存清理、错误状态重启后重置、日志级别调整等功能

## 具体问题

1. 服务器挂掉、网络不通
2. 服务器重启后，需要检查哪些配置的问题（重新挂载mount）
3. 组件挂掉
4. 上、下游系统挂掉：策略重启或挂掉、行情源、交易参数上场、交易所挂掉

## 熟悉客户项目

- 各项目地的系统版本
- 客户环境
- 客户测试周计划、上线计划
- 客户问题文档

## 沟通

- 腾讯会议 + 共享屏幕
- 日志、配置文件、代码

## 准备工作

### 专业、业务知识

1. 系统的业务知识：现货、期权、清算
2. 版本内容
3. 核心链路：清算流程、每日运维、交易流程、风控流程

## 订单问题

- 拒绝码列表
- 交易链路：API -> ATP(TE -> ORS) -> 交易所(摄合)

## 本地

1. 本地环境搭建：数据库、Docker 环境、代码
2. 发布件：应急手册、升级手册
3. 概要设计

准确记录问题和解决闭环

1. 记录问题、版本、bug 号、解决方案、解决时间、解决人： 飞书文档、飞书多维表格、JIRA、内网Confluence

## 日志

> 出现问题后，日志可能是我们开发人员最直接的线索，所以日志的重要性不言而喻。日志的作用主要有两个方面：1. 问题排查；2. 问题定位。

1. 系统标准实时终端输出日志: ~/log/log_组件实例名.out  主要是系统启动前的日志和未被捕获的异常信息
2. 应用全量日志: ~/log/log_组件实例名_日期.log 应用的标准日志，可以通过 logback.xml 指定日志输出级
别
3. 应用指标文件: ~/log/ind__组件实例名_日期.ind 应用的心跳日志和指标数据
4. 错误日志: ~/1og/evt__组件实例名_日期.log 应用的错误日志
